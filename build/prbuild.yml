name: $(date:yyyy-MM-dd)$(rev:.rr)
trigger: none
pr: none
variables:
  BuildPlatform: 'x86'
  SignAppForRelease: 'false'
  TeamName: 'Accessibility Insights Windows'
  system.debug: 'true' #set to true in case our signed build flakes out again
  runCodesignValidationInjection: 'false'

jobs:
- job: StaticAnalysisTest
  pool:
    vmImage: 'windows-2019'
  variables:
    PublicRelease: 'false'
  steps:
  - task: NuGetToolInstaller@1
    displayName: 'Use NuGet 5.x'
    inputs:
      versionSpec: '5.x'

  - task: NuGetCommand@2
    displayName: 'NuGet restore'

  - task: DotNetCoreCLI@2
    displayName: 'dotnet restore'
    inputs:
      command: restore
      projects: |
        **\*.csproj

  - task: VSBuild@1
    displayName: 'Build Solution **\*.sln'
    inputs:
      vsVersion: 16.0
      platform: '$(BuildPlatform)'
      configuration: release

  - task: ms.build-release-task.custom-build-release-task.wpf-static-analysis@0
    displayName: 'WPF Static Analysis'
    inputs:
      input: 'src\AccessibilityInsights\bin\Release'
